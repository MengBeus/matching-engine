# 面试文档（Week1-Week2 问题复盘）

## 文档目的
- 记录项目推进中真实遇到的问题。
- 说明每个问题的定位过程与解决方案。
- 沉淀可复用的方法，便于面试时讲“问题-决策-结果”。

## Week1：需求冻结与技术基线

### 1. 文件路径写错（`.mdf`）
- 问题：最初把 `WORK_PLAN.md` 写成了 `WORK_PLAN.mdf`，导致定位文件失败。
- 解决：统一使用正确文件名并核对目录，后续用固定路径引用。
- 复盘：先确认路径再讨论内容，避免无效沟通。

### 2. 周1文档完成，但工程骨架缺失
- 问题：只有文档，没有 `cmd/`、`internal/`、`pkg/` 和可启动服务。
- 解决：补齐最小可运行骨架，增加 `cmd/api/main.go` 与 `/health` 接口。
- 复盘：周计划验收必须覆盖“文档 + 可运行代码”。

### 3. `make run` 在 Windows 环境不可用
- 问题：本机未安装 `make`，`make run` 报错。
- 解决：移除 `Makefile` 依赖，改为直接命令：`go run ./cmd/api`、`go test ./...`。
- 复盘：工具链要贴合实际环境，避免引入非必要门槛。

### 4. 模块名与项目目标不一致
- 问题：`go.mod` 初始模块名为 `health-checker`，与项目名不一致。
- 解决：模块名改为 `matching-engine`，同步更新 import。
- 复盘：模块命名要尽早统一，减少后期重构成本。

### 5. 服务端口冲突（`:8080` 被占用）
- 问题：启动报错 `bind: Only one usage of each socket address...`。
- 解决：支持 `APP_ADDR` 配置端口，冲突时切换到 `:9090`。
- 复盘：运行配置要可变，不能写死在代码里。

### 6. API 数值类型不统一
- 问题：文档早期使用字符串小数表示价格数量，后续实现计划使用整数最小单位。
- 解决：在 Week1 API 契约中冻结 `price_int`、`quantity_int`（`int64`）与 `scale` 换算规则。
- 复盘：交易系统数值必须先统一，否则后续实现与文档会冲突。

## Week2：撮合内核输入输出冻结

### 7. 只定义了结构体，缺少关键字段校验
- 问题：`PlaceOrderRequest.Validate()` 未校验 `side`，非法值可进入引擎。
- 解决：新增 `Side.IsValid()`，强校验只允许 `BUY/SELL`。
- 复盘：合同校验要覆盖枚举值，不只校验非空。

### 8. 命名不一致（事件名冲突）
- 问题：文档使用 `PlaceOrderAccepted`，代码使用 `OrderAccepted`。
- 解决：统一采用领域事件命名 `OrderAccepted`，同步修改 Week1/Week2 文档与测试。
- 复盘：命名统一比“哪个词更好”更重要，跨文件一致性优先。

### 9. 内外层职责边界不清
- 问题：下单请求中 `order_id` 与 `client_order_id` 语义容易混淆。
- 解决：明确分层：
  - 外部 API 面向客户端（`client_order_id`）
  - 内部请求面向引擎（`order_id` 由接入层生成）
  并在 `PlaceOrderRequest` 中要求 `client_order_id` 必填。
- 复盘：先定边界再编码，能减少接口反复。

### 10. 撤单原因字段过于宽松
- 问题：`canceled_by` 使用自由字符串，容易产生脏值。
- 解决：改为 `CancelReason` 枚举（`USER/SYSTEM/EXPIRED`）。
- 复盘：关键领域字段优先枚举化，便于审计与统计。

### 11. 合同测试不够严格
- 问题：测试只判断“是否报错”，不校验错误内容。
- 解决：补充错误消息断言，并新增 `invalid side`、`missing client_order_id`、`CancelReason` 合同测试。
- 复盘：合同测试要锁住行为细节，避免“测试绿但语义变了”。

## 最终收获（可用于面试表达）
- 能把“先文档冻结，再代码落地，再测试固化”的流程跑通。
- 能识别并修复文档-代码不一致问题（命名、字段、规则）。
- 能根据环境约束做工程取舍（去 `make`、改直接命令）。
- 能将核心风险前置（数值类型、枚举校验、配置化端口、合同测试）。

## 可复用方法论
1. 先冻结输入输出，再写核心算法。
2. 先统一命名，再扩展模块。
3. 先保证可运行，再追求复杂功能。
4. 文档、代码、测试三者必须同频更新。
